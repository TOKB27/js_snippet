<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bootstrap + jQuery（テーブル＋絞り込み＋モーダル閲覧/編集）</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* readonly は見た目で分かるように */
    .form-control[readonly] {
      cursor: not-allowed;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container py-4">

    <!-- Header -->
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
      <h1 class="h4 m-0">トップ画面</h1>

      <div class="d-flex gap-2">
        <!-- Pull-down filter -->
        <select class="form-select form-select-sm w-auto" id="statusFilter">
          <option value="">すべて</option>
          <option value="有効">有効</option>
          <option value="停止">停止</option>
        </select>

        <button class="btn btn-primary btn-sm" type="button">新規作成</button>
      </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th style="width: 90px;">操作</th>
                <th>ID</th>
                <th>名前</th>
                <th>状態</th>
                <th>更新日</th>
              </tr>
            </thead>

            <tbody id="mainTbody">
              <tr data-status="有効">
                <td>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm js-open-modal"
                    data-bs-toggle="modal"
                    data-bs-target="#detailModal"
                    data-id="101"
                    data-name="田中 太郎"
                    data-status="有効"
                    data-updated="2025-12-17"
                  >
                    詳細
                  </button>
                </td>
                <td>101</td>
                <td>田中 太郎</td>
                <td><span class="badge text-bg-success">有効</span></td>
                <td>2025-12-17</td>
              </tr>

              <tr data-status="停止">
                <td>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm js-open-modal"
                    data-bs-toggle="modal"
                    data-bs-target="#detailModal"
                    data-id="102"
                    data-name="佐藤 花子"
                    data-status="停止"
                    data-updated="2025-12-10"
                  >
                    詳細
                  </button>
                </td>
                <td>102</td>
                <td>佐藤 花子</td>
                <td><span class="badge text-bg-secondary">停止</span></td>
                <td>2025-12-10</td>
              </tr>

              <tr data-status="有効">
                <td>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm js-open-modal"
                    data-bs-toggle="modal"
                    data-bs-target="#detailModal"
                    data-id="103"
                    data-name="鈴木 次郎"
                    data-status="有効"
                    data-updated="2025-11-30"
                  >
                    詳細
                  </button>
                </td>
                <td>103</td>
                <td>鈴木 次郎</td>
                <td><span class="badge text-bg-success">有効</span></td>
                <td>2025-11-30</td>
              </tr>
            </tbody>

          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal -->
  <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">

        <!-- Modal header (mode switch at top) -->
        <div class="modal-header d-flex justify-content-between align-items-center">
          <h5 class="modal-title">詳細</h5>

          <div class="btn-group btn-group-sm" role="group" aria-label="閲覧編集切り替え">
            <button type="button" class="btn btn-outline-secondary active" id="viewModeBtn">閲覧</button>
            <button type="button" class="btn btn-outline-secondary" id="editModeBtn">編集</button>
          </div>
        </div>

        <div class="modal-body">
          <form id="detailForm">

            <!-- ID -->
            <div class="row mb-3">
              <label class="col-sm-3 col-form-label">ID</label>
              <div class="col-sm-9">
                <p class="form-control-plaintext view-mode" id="viewId">-</p>
                <input
                  type="text"
                  class="form-control edit-mode d-none bg-light text-muted"
                  id="editId"
                  readonly
                  tabindex="-1"
                >
              </div>
            </div>

            <!-- 名前 -->
            <div class="row mb-3">
              <label class="col-sm-3 col-form-label">名前</label>
              <div class="col-sm-9">
                <p class="form-control-plaintext view-mode" id="viewName">-</p>
                <input type="text" class="form-control edit-mode d-none" id="editName">
              </div>
            </div>

            <!-- 状態 -->
            <div class="row mb-3">
              <label class="col-sm-3 col-form-label">状態</label>
              <div class="col-sm-9">
                <p class="form-control-plaintext view-mode" id="viewStatus">-</p>
                <select class="form-select edit-mode d-none" id="editStatus">
                  <option value="有効">有効</option>
                  <option value="停止">停止</option>
                </select>
              </div>
            </div>

            <!-- 更新日 -->
            <div class="row mb-0">
              <label class="col-sm-3 col-form-label">更新日</label>
              <div class="col-sm-9">
                <p class="form-control-plaintext view-mode" id="viewUpdated">-</p>
                <input type="date" class="form-control edit-mode d-none" id="editUpdated">
              </div>
            </div>

          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">閉じる</button>
          <button type="submit" class="btn btn-success edit-mode d-none" form="detailForm">保存</button>
        </div>

      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    $(function () {
      // ====== Filter (pull-down) ======
      $("#statusFilter").on("change", function () {
        const selected = $(this).val();

        $("#mainTbody tr").each(function () {
          const status = $(this).data("status");
          $(this).toggle(!selected || status === selected);
        });
      });

      // ====== Mode switch (view <-> edit) ======
      function switchToViewMode() {
        $("#detailModal .edit-mode").addClass("d-none");
        $("#detailModal .view-mode").removeClass("d-none");
        $("#viewModeBtn").addClass("active");
        $("#editModeBtn").removeClass("active");
      }

      function switchToEditMode() {
        $("#detailModal .view-mode").addClass("d-none");
        $("#detailModal .edit-mode").removeClass("d-none");
        $("#editModeBtn").addClass("active");
        $("#viewModeBtn").removeClass("active");
      }

      $("#viewModeBtn").on("click", switchToViewMode);
      $("#editModeBtn").on("click", switchToEditMode);

      // Close modal => always back to view mode
      $("#detailModal").on("hidden.bs.modal", function () {
        switchToViewMode();
      });

      // ====== Open modal & inject values ======
      $(document).on("click", ".js-open-modal", function () {
        const $btn = $(this);

        // view
        $("#viewId").text($btn.data("id") ?? "-");
        $("#viewName").text($btn.data("name") ?? "-");
        $("#viewStatus").text($btn.data("status") ?? "-");
        $("#viewUpdated").text($btn.data("updated") ?? "-");

        // edit
        $("#editId").val($btn.data("id") ?? "");
        $("#editName").val($btn.data("name") ?? "");
        $("#editStatus").val($btn.data("status") ?? "有効");
        $("#editUpdated").val($btn.data("updated") ?? "");

        switchToViewMode();
      });

      // ====== Save (demo: update table + button data) ======
      $("#detailForm").on("submit", function (e) {
        e.preventDefault();

        const id = $("#editId").val();
        const name = $("#editName").val();
        const status = $("#editStatus").val();
        const updated = $("#editUpdated").val() || "-";

        // 対象行を探す（2列目のIDで一致）
        const $row = $("#mainTbody tr").filter(function () {
          return $(this).find("td:eq(1)").text().trim() === id;
        });

        if ($row.length) {
          $row.data("status", status);
          $row.attr("data-status", status); // フィルターのために属性も更新

          $row.find("td:eq(2)").text(name);
          $row.find("td:eq(4)").text(updated);

          const badgeClass = (status === "有効") ? "text-bg-success" : "text-bg-secondary";
          $row.find("td:eq(3)").html(`<span class="badge ${badgeClass}">${status}</span>`);

          // 次回モーダル表示用にボタンのdataも更新
          $row.find(".js-open-modal").data({
            name: name,
            status: status,
            updated: (updated === "-" ? "" : updated)
          });
        }

        // モーダル表示側も更新して閲覧モードへ
        $("#viewId").text(id);
        $("#viewName").text(name);
        $("#viewStatus").text(status);
        $("#viewUpdated").text(updated);

        switchToViewMode();
      });
    });
  </script>

</body>
</html>